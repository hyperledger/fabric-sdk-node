<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Hyperledger Fabric SDK for Node.js Tutorial: fabric-common: How to set gRPC settings</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cosmo.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Hyperledger Fabric SDK for Node.js</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-fabric-network.html">fabric-network</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="AffiliationService.html">AffiliationService</a></li><li><a href="BaseClient.html">BaseClient</a></li><li><a href="BlockDecoder.html">BlockDecoder</a></li><li><a href="global.html#ChaincodeEvent">ChaincodeEvent</a></li><li><a href="Channel.html">Channel</a></li><li><a href="Client.html">Client</a></li><li><a href="Commit.html">Commit</a></li><li><a href="Committer.html">Committer</a></li><li><a href="CryptoKeyStore.html">CryptoKeyStore</a></li><li><a href="CryptoSuite.html">CryptoSuite</a></li><li><a href="CryptoSuite_ECDSA_AES.html">CryptoSuite_ECDSA_AES</a></li><li><a href="CryptoSuite_PKCS11.html">CryptoSuite_PKCS11</a></li><li><a href="Discoverer.html">Discoverer</a></li><li><a href="DiscoveryHandler.html">DiscoveryHandler</a></li><li><a href="DiscoveryService.html">DiscoveryService</a></li><li><a href="ECDSA_KEY.html">ECDSA_KEY</a></li><li><a href="global.html#Endorsement">Endorsement</a></li><li><a href="Endorser.html">Endorser</a></li><li><a href="Endpoint.html">Endpoint</a></li><li><a href="Eventer.html">Eventer</a></li><li><a href="global.html#EventInfo">EventInfo</a></li><li><a href="EventService.html">EventService</a></li><li><a href="FabricCAClient.html">FabricCAClient</a></li><li><a href="FabricCAServices.html">FabricCAServices</a></li><li><a href="Hash.html">Hash</a></li><li><a href="Identity.html">Identity</a></li><li><a href="IdentityContext.html">IdentityContext</a></li><li><a href="IdentityService.html">IdentityService</a></li><li><a href="InMemoryKeyValueStore.html">InMemoryKeyValueStore</a></li><li><a href="Key.html">Key</a></li><li><a href="KeyValueStore.html">KeyValueStore</a></li><li><a href="module.exports_module.exports.html">module.exports#module.exports</a></li><li><a href="module-fabric-network.Contract.html">fabric-network.Contract</a></li><li><a href="module-fabric-network.DefaultCheckpointers.html">fabric-network.DefaultCheckpointers</a></li><li><a href="module-fabric-network.FabricError.html">fabric-network.FabricError</a></li><li><a href="module-fabric-network.Gateway.html">fabric-network.Gateway</a></li><li><a href="module-fabric-network.HsmX509Provider.html">fabric-network.HsmX509Provider</a></li><li><a href="module-fabric-network.IdentityProviderRegistry.html">fabric-network.IdentityProviderRegistry</a></li><li><a href="module-fabric-network.TimeoutError.html">fabric-network.TimeoutError</a></li><li><a href="module-fabric-network.Transaction.html">fabric-network.Transaction</a></li><li><a href="module-fabric-network.Wallet.html">fabric-network.Wallet</a></li><li><a href="module-fabric-network.Wallets.html">fabric-network.Wallets</a></li><li><a href="NetworkConfig.html">NetworkConfig</a></li><li><a href="PKCS11_ECDSA_KEY.html">PKCS11_ECDSA_KEY</a></li><li><a href="Proposal.html">Proposal</a></li><li><a href="Query.html">Query</a></li><li><a href="ServiceAction.html">ServiceAction</a></li><li><a href="ServiceEndpoint.html">ServiceEndpoint</a></li><li><a href="ServiceHandler.html">ServiceHandler</a></li><li><a href="Signer.html">Signer</a></li><li><a href="SigningIdentity.html">SigningIdentity</a></li><li><a href="User.html">User</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="interfaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Interfaces<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-fabric-network.BlockEvent.html">fabric-network.BlockEvent</a></li><li><a href="module-fabric-network.Checkpointer.html">fabric-network.Checkpointer</a></li><li><a href="module-fabric-network.CommitEvent.html">fabric-network.CommitEvent</a></li><li><a href="module-fabric-network.ContractEvent.html">fabric-network.ContractEvent</a></li><li><a href="module-fabric-network.Network.html">fabric-network.Network</a></li><li><a href="module-fabric-network.Query.html">fabric-network.Query</a></li><li><a href="module-fabric-network.QueryHandler.html">fabric-network.QueryHandler</a></li><li><a href="module-fabric-network.TransactionEvent.html">fabric-network.TransactionEvent</a></li><li><a href="module-fabric-network.TxEventHandler.html">fabric-network.TxEventHandler</a></li><li><a href="module-fabric-network.WalletStore.html">fabric-network.WalletStore</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-discovery-fabric-network.html">fabric-network: How to use the discovery service</a></li><li><a href="tutorial-grpc-settings.html">fabric-common: How to set gRPC settings</a></li><li><a href="tutorial-handlers.html">fabric-common: How to use the endorsement, query, and commit handlers</a></li><li><a href="tutorial-logging.html">fabric-common: How to use logging</a></li><li><a href="tutorial-migration.html">Migrating client applications from v1.4 to v2.0</a></li><li><a href="tutorial-query-peers.html">fabric-network: How to select peers for evaluating transactions (queries)</a></li><li><a href="tutorial-sign-transaction-offline.html">fabric-common: Working with an offline private key</a></li><li><a href="tutorial-transaction-commit-events.html">fabric-network: How to wait for transactions to be committed to the ledger</a></li><li><a href="tutorial-wallet.html">fabric-network: Using wallets to manage identities</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#allSettled">allSettled</a></li><li><a href="global.html#bitsToBytes">bitsToBytes</a></li><li><a href="global.html#bytesToBits">bytesToBits</a></li><li><a href="global.html#cachedResult">cachedResult</a></li><li><a href="global.html#CLIENT">CLIENT</a></li><li><a href="global.html#crypto">crypto</a></li><li><a href="global.html#HFAFFILIATIONMGR">HFAFFILIATIONMGR</a></li><li><a href="global.html#HFGENCRL">HFGENCRL</a></li><li><a href="global.html#HFINTERMEDIATECA">HFINTERMEDIATECA</a></li><li><a href="global.html#HFREGISTRARATTRIBUTES">HFREGISTRARATTRIBUTES</a></li><li><a href="global.html#HFREGISTRARDELEGATEROLES">HFREGISTRARDELEGATEROLES</a></li><li><a href="global.html#HFREGISTRARROLES">HFREGISTRARROLES</a></li><li><a href="global.html#HFREVOKER">HFREVOKER</a></li><li><a href="global.html#newCryptoSuite">newCryptoSuite</a></li><li><a href="global.html#newInstance">newInstance</a></li><li><a href="global.html#ORDERER">ORDERER</a></li><li><a href="global.html#PEER">PEER</a></li><li><a href="global.html#setLogger">setLogger</a></li><li><a href="global.html#shuffle">shuffle</a></li><li><a href="global.html#TYPE">TYPE</a></li><li><a href="global.html#USER">USER</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			<section class="tutorial-section">

<header>
    

    <h2>fabric-common: How to set gRPC settings</h2>
</header>

<article>
    <p>This tutorial illustrates the different ways of setting the gRPC settings used on connections to the Hyperledger Fabric network with a Hyperledger Fabric Node.js Client as of 2.0</p>
<p>The following assumes an understanding of the Hyperledger Fabric network
(orderers and peers),
and of Node application development.</p>
<h3>Overview</h3>
<p>The Hyperledger Fabric Node.js javascript SDK, <code>fabric-common</code>,  communicates
with a Hyperledger Fabric network using gRPC. The gRPC technology, framework,
handles moving data reliably between the fabric network and the fabric client
application.
fabric-common allows the application to provide settings required to control
the environment.</p>
<p>fabric-common has default connection options that include default gRPC settings.
There are various ways for the application to override the default connection
options.</p>
<h3>Default connection options</h3>
<p>fabric-common has the following gRPC connection options as defaults.
These are in the <code>default.json</code> system configuration file that is included
with the fabric-common NPM package.</p>
<pre class="prettyprint source"><code>	&quot;connection-options&quot;: {
		&quot;grpc.max_receive_message_length&quot;: -1,
		&quot;grpc.max_send_message_length&quot;: -1,
		&quot;grpc.keepalive_time_ms&quot;: 120000,
		&quot;grpc.http2.min_time_between_pings_ms&quot;: 120000,
		&quot;grpc.keepalive_timeout_ms&quot;: 20000,
		&quot;grpc.http2.max_pings_without_data&quot;: 0,
		&quot;grpc.keepalive_permit_without_calls&quot;: 1
	}
</code></pre>
<ul>
<li><code>grpc.max_receive_message_length</code> - Maximum message length that the channel
can receive. Int valued, bytes. -1 means unlimited.</li>
<li><code>grpc.max_send_message_length</code> - Maximum message length that the channel can
send. Int valued, bytes. -1 means unlimited.</li>
<li><code>grpc.keepalive_time_ms</code> - After a duration of this time the client/server
pings its peer to see if the transport is still alive. Int valued, milliseconds.</li>
<li><code>grpc.keepalive_timeout_ms</code> - After waiting for a duration of this time,
if the keepalive ping sender does not receive the ping ack, it will close the
transport. Int valued, milliseconds.</li>
<li><code>grpc.keepalive_permit_without_calls</code> - Is it permissible to send keepalive
pings without any outstanding streams. Int valued, 0(false)/1(true).</li>
<li><code>grpc.http2.min_time_between_pings_ms</code> - Minimum time between sending
successive ping frames without receiving any data frame.
Int valued, milliseconds.</li>
<li><code>grpc.http2.max_pings_without_data</code> - Minimum allowed time between a server
receiving successive ping frames without sending any data frame.
Int valued, milliseconds.</li>
</ul>
<h3>Change default connection options</h3>
<p>The application may have a need to change or add new gRPC settings.
By using the system configuration, the application may change the default
connection options used for all new connections established.</p>
<p>The default connection options are retrieved as a set of options when
the <a href="Client.html">Client</a> instance builds new Endorserss or new Orderers.
To modify the  default connection options before runtime, update the
<code>default.json</code> file or add your own configuration file to the system configuration.
The last file loaded will override all previous files including the <code>default.json</code>
file shipped with the fabric-common. see <a href="BaseClient.html#.addConfigFile">BaseClient.addConfigFile</a>.</p>
<pre class="prettyprint source"><code>const Client = require('fabric-common');
Client.addConfigFile(&lt;path to the config file>);
</code></pre>
<p>To modify the default connection options during runtime, get them from the
system configuration, make modifications, then set them back on the system
configuration.</p>
<pre class="prettyprint source"><code>const default_options = client.getConfigSetting('connection-options');
const new_option = {
    'grpc.keepalive_timeout_ms': 10000
};

// use the assign call to keep all other options and only update
// the one setting or add a setting.
const new_defaults = Object.assign(default_options, new_option);
client.setConfigSetting('connection-options', new_defaults);

// peer will have default options
const peer = client.newPeer(url, options);
</code></pre>
<p>Note: Making a change to the system configuration will have all new
connections use new default connection options. This includes the
connections that are created by new peers and new orderers that are
created automatically when using the discovery service.
Be careful when assigning new values to not remove other values.
All the default connection options are contained in the one system
configuration setting <code>connection-options</code>.</p>
<h3>Add connection options to the client</h3>
<p>The application may have a need to change or add new gRPC settings.
The application may add connection options to the client instance
that may be new options or to override existing default connection
options stored in the system configuration. See the above
discussion on how to change the options within the system configuration.</p>
<pre class="prettyprint source"><code>const new_options = {
    'grpc.keepalive_timeout_ms': 10000
};
client.addConnectionOptions(new_options);

// peer will have options from default and from client
const peer = client.newPeer(url, options);

// discovered peers will have options from default and from client
channel.initialize({discover: true, target: peer});
</code></pre>
<p>Note: All new connections created by this client, including those created
automatically when using the discovery service will use the client's
connection options to override the default connection options.</p>
<h3>Add connection options on create</h3>
<p>The application may need unique connection options for individual
peers or orderers. Unique settings may be passed on the
Client#newPeer or
Client#newOrderer calls in the option parameter.
Options passed in on the call will override both the client based
options and the system configuration based options.</p>
<pre class="prettyprint source"><code>const options = {
    pem: '&lt;pem string>',
	'ssl-target-name-override': 'myhost.org1.com',
    'grpc.keepalive_timeout_ms': 10000
};

// peer will have options from default, client, and parameter
const peer = client.newPeer(url, options);
</code></pre>
<p>Note: Connection options passed on the <code>newPeer()</code> and the <code>newOrderer()</code>
calls will only be used for that peer or orderer.</p>
<h3>Add connection options to a common connection profile</h3>
<p>Connection options may be set at the client level or individually on peers and
orderers when using a common connection profile. In the following profile
both the client section and one peer have a gRPC setting.</p>
<pre class="prettyprint source"><code>client:
  # Which organization does this application instance belong to? The value is the name of an org
  # defined under &quot;organizations&quot;
  organization: Org1

  # set connection timeouts for the peer and orderer for the client
  connection:
    timeout:
      peer:
        # the timeout in seconds to be used on requests to a peer,
        # for example 'sendTransactionProposal'
        endorser: 120
        # the timeout in seconds to be used by applications when waiting for an
        # event to occur. This time should be used in a javascript timer object
        # that will cancel the event registration with the channel event hub instance.
        eventHub: 60
        # the timeout in seconds to be used when setting up the connection
        # with the peer event hub. If the peer does not acknowledge the
        # connection within the time, the application will be notified over the
        # error callback if provided.
        eventReg: 3
      # the timeout in seconds to be used on request to the orderer,
      # for example
      orderer: 30
      # connection options, typically these will be common GRPC settings,
      # overriding what has been set in the system config file &quot;default.json&quot;
    options:
      grpc.keepalive_timeout_ms: 10000
peers:
  peer1.org2.example.com:
    url: grpcs://localhost:8051
    grpcOptions:
      ssl-target-name-override: peer1.org2.example.com
      grpc.keepalive_timeout_ms: 20000
    tlsCACerts:
      path: test/fixtures/channel/c...
  peer2.org2.example.com:
    url: grpcs://localhost:8052
    grpcOptions:
      ssl-target-name-override: peer2.org2.example.com
    tlsCACerts:
      path: test/fixtures/channel/c...
</code></pre>
<p>Note: All new connections created by this client, including those created
automatically when using the discovery service will use the client's
connection options to override the default connection options. <code>peer1</code>
will be override the one setting with it's own unique value. <code>peer2</code>
will not override any of the client's or the system defaults.
The application may call the <code>client.addConnectionOptions()</code> to add
additional settings or override settings. Peers created by a call
to Client#getPeer or orderers created by a call to
Client#getOrderer or by a call to <a href="Client.html#getChannel">Client#getChannel</a>
after the add call will use the new set of values.
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>
</article>

</section>

		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a>
	
		on 2020-03-31T18:32:43+00:00
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : false,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>